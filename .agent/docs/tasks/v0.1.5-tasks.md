# v0.1.5 タスク

## 目的
v0.1.4 に続く小リリース。統計ダッシュボード、デプロイ、パフォーマンス改善、Chrome拡張準備など。

## 機能

### ダッシュボード実装計画（Chart.js）

 [x] Repository/Store 実装：`stores/pages/dashboard.ts`（実装済）。API 呼び出しは `apiClient.getDashboardStats()` を使用する（`repositories/stats.ts` は型定義のみ）。
- [x] E2E スモークテスト追加：`tests/integration/dashboard.spec.ts`
- [x] スタイル調整・レスポンシブ対応（`assets/css`）

## ワーカー / API 作業

- [x] `GET /api/v1/stats` の API 設計（上部の API 仕様を参照）
- [x] `GET /api/v1/stats` の Workers 実装（集計クエリ、期間クエリ対応）
	- 実装場所: `workers/index.ts` の `GET /api/v1/stats` エンドポイント（ユーザー別集計、`range` クエリ対応）
- [x] Workers のリファクタリング（ファイル分割・ルート分割）


## デプロイ / インフラ
- [ ] Pages + Workers のデプロイ設定とドキュメント化
- [ ] `wrangler.toml` / CI の最終確認（環境変数・シークレット）

### Deploy: Secrets & CI 設定

- **必須シークレット**:
	- `WRANGLER_API_TOKEN`: Cloudflare API token（Workers publish 権限）
	- `JWT_SECRET`: Workers 側で使用する JWT の秘密鍵（`wrangler.toml` の `vars.JWT_SECRET` を上書き）
	- `D1_DATABASE_ID`（またはプロジェクトで使っている `DB` バインディング用のデータベース ID）
	- （オプション）R2 関連の `R2_BUCKET` / `R2_ACCESS_KEY` 等（画像アップロードを使う場合）

- **GitHub Actions にシークレットを設定する手順**:
	1. リポジトリの Settings → Secrets → Actions を開く
	2. 上記キーを追加（例: `WRANGLER_API_TOKEN`, `JWT_SECRET`, `D1_DATABASE_ID`）
	3. `WRANGLER_API_TOKEN` は必要最小限の権限（scripts: edit/publish）で作成する

- **CI の挙動**:
	- `.github/workflows/ci-deploy.yml` は `WRANGLER_API_TOKEN` が存在する場合に `npx wrangler publish --dry-run` を実行します。
	- 本番公開を CI で行うなら、`--dry-run` を外すか別ジョブで `wrangler publish` を実行するワークフローを作成してください。

- **ローカル検証コマンド例**:

```
WRANGLER_API_TOKEN=xxxxx npx wrangler publish --dry-run
```

- **注意点**:
	- シークレットは絶対にソース管理に含めないこと。`wrangler.toml` に直接シークレットを書かず、CI シークレットで上書きしてください。
	- `d1_databases` の `database_id` は Cloudflare ダッシュボードで払い出された ID を利用するか、CI シークレット経由で注入します。


## 品質 / パフォーマンス
- [ ] パフォーマンス計測（ Lighthouse / ページロード）と主要改善項目の適用
- [ ] 統合テスト（recipes の主要フロー）を安定化

## 拡張 & その他
- [ ] Chrome拡張連携の設計（OAuth / API範囲 / マニフェスト）
- [ ] CHANGELOG の更新（v0.1.5）
