## [UI] #XXX: Nuxt UI unresolved component warnings during dev/tests

**Question**: When running the dev server or Vitest, Vue emits warnings like "Failed to resolve component: UFormGroup" and "Extraneous non-props attributes ...". How should we handle this?

**Answer**: Implement lightweight stubs and a layout fix to suppress warnings in dev and test environments. Specifically:

- Add `plugins/00-nuxt-ui-stubs.ts` to register PascalCase and kebab-case component stubs early.
- Ensure stubs render a DOM root (`div`) and forward `attrs` so non-props attributes and event listeners are not dropped.
- Add `plugins/nuxt-ui-stubs.ts` as a secondary plugin and update `tests/setup.ts` to register test-time stubs.
- Use `<NuxtLayout>` in `app/app.vue` / `app/layouts/default.vue` to avoid the "NuxtLayout not used" warning.

**Decided on**: 2025-12-15
**Related**: release/v0.1.3 (PR #15)

## v0.1.3 — QA / 未解決事項リスト

このファイルは v0.1.3 で対処する「不明点・決定が必要な項目」を洗い出し、経緯と次アクションを記録します。

## 決定事項
- **認証**: セキュリティ重視で進める。短命のアクセストークン（例: 15分）＋長期（30日）リフレッシュトークンを採用し、リフレッシュトークンは `Secure`, `HttpOnly`, `SameSite` を適切に設定した cookie に保存する。リフレッシュのローリング（rotation）と失効エンドポイントを実装し、CSRF 対策を行う。通信は常に HTTPS。
- **ローディング**: デフォルトはグローバル（ページ遷移・主要操作）で採用。ただし部分更新が多い箇所はページ/コンポーネント単位のローカルローディングを併用するハイブリッド運用とする。
- **トースト**: NuxtUI を直接呼ぶのではなく、`useAppToast` のラッパー層を実装して、表示ロジックを集中させる。
	- **実装補足**: テスト環境や NuxtUI が読み込まれない実行環境では安全に no-op する挙動を追加しました（`useAppToast` がフォールバックする）。
	- **完了**: `useAppToast` を実装し、ユニットテストを追加しました。ブランチ: `feature/#14-implement-useapptoast`。
- **UX 標準化**: 全体に適用するルールを作成し、例外は明示的に管理（QA/Issue で追跡）。
 - **オンボーディング更新**: タスク開始前のタスクリスト確認・開発計画作成、不明点は `.agent/docs/qa/` に記録、作業完了時にタスクリストと `.agent/specs` を更新するワークフローを `agent-onboarding.md` に追加。
 - **オンボーディング更新**: タスク開始前のタスクリスト確認・開発計画作成、不明点は `.agent/docs/qa/` に記録、作業完了時にタスクリストと `.agent/specs` を更新するワークフローを `agent-onboarding.md` に追加。
 - **Issue #13 実装完了**: `tags`/`recipes` のデータストア API 実装（`app/stores/data/*`）および `ui` ストアの global loading を実装し、ユニットテストを追加しました。次は統合/E2E/a11y の拡充と `CHANGELOG.md` 反映です。

## 追加で確認すべき事項（提案）
- セッション一覧・デバイス管理 API（ログアウト／失効）を用意するか
- リフレッシュトークンのローリング戦略（返却トークンを入れ替えるか）とリプレイ防止
- cookie 周りのクロスブラウザ挙動と SameSite 設定の検証（mobile/webview 含む）
- 監査ログ／異常検知（不正なリフレッシュ試行等）をどう扱うか
- 認証フローの E2E テスト（実際に cookie をセットして更新されるか）を追加する

次アクション: これらの決定を `.agent/specs/auth.md` にまとめ、優先 Issue を作成します。Issue 作成してよければ実行しますか？

### [API / 認証] `useAuth` の Cloudflare Workers 統合
**質問**: `useAuth` はどの認証フローを採用すべきか（セッション JWT / cookie / OAuth）および Workers 側 API の contract（エンドポイント・レスポンス・エラーコード）はどうあるべきか？

**懸念点**:
- トークンの保管（cookie の Secure/HttpOnly）と有効期限管理
- Workers 側でのエラー変換（どのエラーを CustomError に変換するか）
- ネットワーク障害時のリトライ方針とタイムアウト

**次アクション**: API の最小契約（エンドポイント、リクエスト/レスポンス例）を定義して `.agent/specs/` に追加。担当: @kai（見積: 2d）

### [Repository / Store] tags/recipes の未実装 API 呼び出し
**質問**: 現在 TODO のある store/repository メソッド（create/update/delete／pagination）の仕様（引数・戻り値・エラー）を確定する必要あり。

**懸念点**:
- 一貫した `CustomError` 使い回しとユーザー向けメッセージ生成の場所（repository で変換／page store で表示）

**次アクション**: 影響範囲の API スペックを作成し、サンプルレスポンスを追加。担当: TBD（見積: 3d）

### [UI] グローバルローディング状態の設計
**質問**: ローディングはページ単位かグローバルか？優先度はどの操作で表示するか（ページ遷移、フェッチ、送信）？

**決定候補**:
- ページストアでグローバル表示（`showLoading()` / `hideLoading()`）、データストアは副作用を持たない

**次アクション**: `store/pages/recipes` に `loading` 管理を追加する仕様書を作る。担当: TBD（見積: 1d）

### [UI] トースト（`useAppToast`）の設計
**質問**: NuxtUI のトーストを直接呼ぶか、抽象ラッパー経由で呼ぶか？トーストの標準的なメッセージ設計（成功/警告/危険）を決める必要あり。

**次アクション**: `useAppToast` を NuxtUI に合わせて実装し、Page Store で利用するサンプルを追加。担当: @kai（見積: 1d）

### [UX] 確認ダイアログの UX 標準化（`app/pages/index.vue`）
**質問**: 削除などの重要操作に対する確認ダイアログの文言、アクセシビリティ(フォーカストラップ)、i18n の方針を決定する。

**次アクション**: 簡易テンプレ（タイトル、本文、Confirm/Cancel）を提案し、コンポーネント化する。担当: TBD（見積: 1d）

### [Testing] 必要なテスト範囲と優先順位
**質問**: 追加実装に対して必要なテスト（unit, integration, E2E, a11y）の最低限を決める。

**優先テスト**:
- `useAuth`：unit + integration（mock の Workers レスポンス）
- repository メソッド：unit
- Page flows（create tag/delete tag）：integration + E2E smoke
- a11y：変更のある UI に axe テストを追加

**次アクション**: 各実装 PR に対応するテストを必須に設定する。担当: PR 作成者（見積: 各 0.5–1d）

### [Docs / Specs] `.agent/specs` と CHANGELOG 更新ルール
**質問**: コード変更に伴う仕様更新（`.agent/specs` / `.agent/docs/tasks` / `CHANGELOG.md`）の適用範囲とテンプレを確定する。

**決定（提案）**: API/Behavior 変更は必ず関連 `.agent/specs` を更新、軽微な lint-only や UI テキストは QA エントリと `spec-exception` ラベルで対応。

**次アクション**: PR テンプレにチェックリストを入れる。担当: @kai（見積: 0.5d）

### [CI / Release] ワークフローの権限と自動タグ作成
**質問**: `Create Release` ワークフローで `github-actions[bot]` がタグを push する際のパーミッション問題（403）が発生している。どう運用するか？（手動実行 or GitHub App / PAT）

**選択肢**:
- Organization / repo の Actions permissions で `GITHUB_TOKEN` の権限を上げる（推奨：最小権限で検討）
- release を CLI / maintainer の手動操作に任せる（現在の fallback）

**次アクション**: 運用方針を決め、リリース手順を書面化する。担当: @kai（見積: 0.5d）

### [Migration & Data] DB 互換性とデータ移行
**質問**: 新しい API/フィールドを導入する場合のマイグレーション方針（DDL の回帰テスト、互換性の維持）を決める。

**次アクション**: 変更が必要になったら `migrations/` にスクリプトを追加し、リリース手順にマイグレーション手順を含める。担当: 実装者（見積: ケースバイケース）

### [Accessibility] カスタムコンポーネントへの ARIA 運用
**質問**: `UInput` / `UButton` のようなコンポーネントに ARIA を付与する基準を厳密化する必要がある（どの属性はコンポーネント側で実装させるか）。

**次アクション**: コンポーネント契約を `.agent/specs` に短く記載し、a11y チェックの対象を明確化する。担当: TBD（見積: 0.5d）

---

## オープンイシュー（最優先）
- Issue: `Implement useAuth Workers integration` — Owner: @kai — Est: 2d
- Issue: `Implement missing tags/recipes repository methods` — Owner: TBD — Est: 3d
- Issue: `Decide release workflow tagging permissions` — Owner: @kai — Est: 0.5d

## TODO スキャン結果（2025-12-15）

- 実行者: 自動スキャン / 手動確認: `@kai` により実査
- 検出箇所概要: `app/composables/useAuth.ts`（複数）、`app/pages/index.vue`（確認ダイアログ）、`app/repositories/*`（tags/recipes の CRUD/pagination 未実装）、`app/stores/data/*`、`app/composables/useLogger.ts`、ドキュメント内 TODO
- 次アクション: 上記を GitHub Issue に登録し、優先度とオーナー、見積を割り当てる（推奨: confirmation dialog → auth → repos → tests）

**注記**: Issue 作成はこのリポジトリ外操作が必要なため、私の側で GitHub Issue を作成してよいですか？可能であれば作成するラベル（`area:auth`, `area:repos`, `priority:P1` など）を指定してください。指定がなければ推奨ラベルを付与します。

## Acceptance criteria
- QA items に対する決定が `.agent/docs/qa/v0.1.3-qa.md` に記録されること
- 最初の 3 件（上のオープンイシュー）が Issue 化され、担当と見積が割り当てられていること

**次のアクション**: このファイルをコミットし、Issue を作成して担当を紐付けます。続けてよければ Issue 作成から始めますか？

***
